class MultiSelect{constructor(e,t={}){let l={placeholder:"Select item(s)",searchPlaceholder:"Search...",labelSelectAll:"Select all",labelSelected:"selected",max:null,search:!0,selectAll:!0,listAll:!0,closeListOnItemSelect:!1,name:"",width:"",height:"",dropdownWidth:"",dropdownHeight:"",data:[],onChange:function(){},onSelect:function(){},onUnselect:function(){}};for(let s in this.options=Object.assign(l,t),this.selectElement="string"==typeof e?document.querySelector(e):e,console.log(this.selectElement.dataset),this.selectElement.dataset)void 0!==this.options[s]&&(this.options[s]=this.selectElement.dataset[s]);let i=this._getName();if(this.name=i.split("[]").join(""),!this.options.data.length){let a=this.selectElement.querySelectorAll("option");for(let o of a){let n=o.closest("optgroup");if(n){let c=n.label;this.options.data.some(e=>e.groupLabel===c)||this.options.data.push({groupLabel:c,options:[]}),this.options.data.find(e=>e.groupLabel===c).options.push({value:o.value,text:o.innerHTML,selected:o.selected,html:o.getAttribute("data-html")})}else this.options.data.push({value:o.value,text:o.innerHTML,selected:o.selected,html:o.getAttribute("data-html")})}}this.element=this._template(),this.selectElement.replaceWith(this.element),this._updateSelected(),this._eventHandlers()}_getName(){return this.selectElement.getAttribute("name")?this.selectElement.getAttribute("name"):"multi-select-"+Math.floor(1e6*Math.random())}_template(){let e="",t="",l="",s="";for(let i of this.data)if(i.groupLabel){for(let a of(e+=`<div class="multi-select-optgroup">
                    <span class="multi-select-optgroup-label">${i.groupLabel}</span>
                    <div class="multi-select-optgroup-options">`,i.options))s+=`
                        <div class="multi-select-option-container">
                            <div class="multi-select-option${this._getSelectedClass(a.value)}" data-value="${a.value}">
                                <span class="multi-select-option-radio"></span>
                                <span class="multi-select-option-text">${this._getText(a)}</span>
                            </div>
                        </div>
                    `;e+=s+"</div></div>",s=""}else t+=`
                    <div class="multi-select-option-container">
                        <div class="multi-select-option${this._getSelectedClass(i.value)}" data-value="${i.value}">
                            <span class="multi-select-option-radio"></span>
                            <span class="multi-select-option-text">${this._getText(i)}</span>
                        </div>
                    </div>
                `;(!0===this.options.selectAll||"true"===this.options.selectAll)&&(l=`<div class="multi-select-all">
                <span class="multi-select-option-radio"></span>
                <span class="multi-select-option-text">${this.options.labelSelectAll}</span>
            </div>`);let o=`
            <div class="multi-select ${this.name}"${this.selectElement.id?' id="'+this.selectElement.id+'"':""} style="${this._getDimension()}">
                <div class="multi-select-hidden-input-area" style="display:none;">
                    ${this.selectedValues.map(e=>`<input type="hidden" name="${this.name}[]" value="${e}">`).join("\r\n")}
                </div>
                <div class="multi-select-header" style="${this._getDimension()}">
                    <span class="multi-select-header-max">${this.options.max?this.selectedValues.length+"/"+this.options.max:""}</span>
                    <span class="multi-select-header-placeholder">${this.placeholder}</span>
                </div>
                <div class="multi-select-options" style="${this.options.dropdownWidth?"width:"+this.options.dropdownWidth+";":""}${this.options.dropdownHeight?"height:"+this.options.dropdownHeight+";":""}">
                    ${!0===this.options.search||"true"===this.options.search?`<input type="text" class="multi-select-search" placeholder="${this.options.searchPlaceholder}">`:""}
                    ${l} 
                    <div class="multi-select-options-container">
                    <div class="multi-select-options-list">${t}</div> 
                    <div class="multi-select-optgroup-list">${e}</div> 
                    </div>
                </div>
            </div>
        `,n=document.createElement("div");return n.innerHTML=o,n.classList.add("multi-select-container"),n}_getText(e){return`${e.html?e.html:e.text}`}_getSelectedClass(e){return`${this.selectedValues.includes(e)?" multi-select-selected":""}`}_getDimension(){return`${this.width?"width:"+this.width+";":""}${this.height?"height:"+this.height+";":""}`}_updateOption(e,t,l){if(!1===this.options.listAll||"false"===this.options.listAll){let s=this.element.querySelector(".multi-select-header-option");null!=s&&s.parentNode.removeChild(s),e.insertAdjacentHTML("afterbegin",`<span class="multi-select-header-option">${this.selectedValues.length} ${this.options.labelSelected}</span>`)}this.element.querySelector(".multi-select-header-placeholder")||e.insertAdjacentHTML("beforeend",`<span class="multi-select-header-placeholder">${this.placeholder}</span>`),this.options.max&&(this.element.querySelector(".multi-select-header-max").innerHTML=this.selectedValues.length+"/"+this.options.max),(!0===this.options.search||"true"===this.options.search)&&(this.element.querySelector(".multi-select-search").value=""),this.element.querySelectorAll(".multi-select-option").forEach(e=>e.style.display="flex"),(!0===this.options.closeListOnItemSelect||"true"===this.options.closeListOnItemSelect)&&e.classList.remove("multi-select-header-active"),this.options.onChange(t.dataset.value,t.querySelector(".multi-select-option-text").innerHTML,t),l?this.options.onSelect(t.dataset.value,t.querySelector(".multi-select-option-text").innerHTML,t):this.options.onUnselect(t.dataset.value,t.querySelector(".multi-select-option-text").innerHTML,t)}_eventHandlers(){let e=this.element.querySelector(".multi-select-header");if(this.element.querySelectorAll(".multi-select-option").forEach(t=>{t.onclick=()=>{let l=!0;if(t.classList.contains("multi-select-selected")){t.classList.remove("multi-select-selected"),this.element.querySelectorAll(".multi-select-header-option").forEach(e=>e.dataset.value==t.dataset.value?e.parentNode.removeChild(e):""),this._removeHiddenInput(t);try{this.data.filter(e=>e.value==t.dataset.value)[0].selected=!1}catch(s){}l=!1}else{if(this._isMax())return;t.classList.add("multi-select-selected"),this._isListAll()&&(this.element.querySelector(".multi-select-header-option")?Array.from(this.element.querySelectorAll(".multi-select-header-option")).pop().insertAdjacentHTML("afterend",`<span class="multi-select-header-option" data-value="${t.dataset.value}">${t.querySelector(".multi-select-option-text").innerHTML}</span>`):e.insertAdjacentHTML("afterbegin",`<span class="multi-select-header-option" data-value="${t.dataset.value}">${t.querySelector(".multi-select-option-text").innerHTML}</span>`)),this.element.querySelector(".multi-select .multi-select-hidden-input-area").insertAdjacentHTML("beforeend",`<input type="hidden" name="${this.name}[]" value="${t.dataset.value}">`);try{this.data.filter(e=>e.value==t.dataset.value)[0].selected=!0}catch(i){}}this._updateOption(e,t,l)}}),e.onclick=()=>e.classList.toggle("multi-select-header-active"),!0===this.options.search||"true"===this.options.search){let t=this.element.querySelector(".multi-select-search");t.oninput=()=>{this.element.querySelectorAll(".multi-select-option").forEach(e=>{e.parentNode.style.display=e.querySelector(".multi-select-option-text").innerHTML.toLowerCase().indexOf(t.value.toLowerCase())>-1?"flex":"none"})}}if(!0===this.options.selectAll||"true"===this.options.selectAll){let l=this.element.querySelector(".multi-select-all");l.onclick=()=>{let e=l.classList.contains("multi-select-selected");l.closest(".multi-select");let t=l.closest(".multi-select").querySelectorAll('input[type="hidden"]');null!=t&&t.forEach(e=>e.parentNode.removeChild(e)),this.element.querySelectorAll(".multi-select-option").forEach(t=>{this.data.find(e=>e.value==t.dataset.value),e||t.classList.remove("multi-select-selected"),t.click()}),l.classList.toggle("multi-select-selected")}}this.selectElement.id&&document.querySelector('label[for="'+this.selectElement.id+'"]')&&(document.querySelector('label[for="'+this.selectElement.id+'"]').onclick=()=>{e.classList.toggle("multi-select-header-active")}),document.addEventListener("click",t=>{t.target.closest("."+this.name)||t.target.closest('label[for="'+this.selectElement.id+'"]')||e.classList.remove("multi-select-header-active")})}_removeHiddenInput(e){let t=this.element.querySelector(`input[value="${e.dataset.value}"]`);null!=t&&t.parentNode.removeChild(t)}_isListAll(){return!0===this.options.listAll||"true"===this.options.listAll}_isMax(){return this.options.max&&this.selectedValues.length>=this.options.max}_updateSelected(){let e=this.element.querySelector(".multi-select-header");!0===this.options.listAll||"true"===this.options.listAll?this.element.querySelectorAll(".multi-select-option").forEach(e=>{e.classList.contains("multi-select-selected")&&this.element.querySelector(".multi-select-header").insertAdjacentHTML("afterbegin",`<span class="multi-select-header-option" data-value="${e.dataset.value}">${e.querySelector(".multi-select-option-text").innerHTML}</span>`)}):this.selectedValues.length>0&&this.element.querySelector(".multi-select-header").insertAdjacentHTML("afterbegin",`<span class="multi-select-header-option">${this.selectedValues.length} ${this.options.labelSelected}</span>`),this.element.querySelectorAll(".multi-select-header-placeholder").forEach(e=>{e.parentNode.removeChild(e)}),this.element.querySelector(".multi-select-header-option")||e.insertAdjacentHTML("afterbegin",`<span class="multi-select-header-placeholder">${this.placeholder}</span>`)}get selectedValues(){return this.data.flatMap(e=>e.options?e.options.filter(e=>e.selected).map(e=>e.value):[])}get selectedItems(){return this.data.flatMap(e=>e.options?e.options.filter(e=>e.selected):[])}set data(e){this.options.data=e}get data(){return this.options.data}set selectElement(e){this.options.selectElement=e}get selectElement(){return this.options.selectElement}set element(e){this.options.element=e}get element(){return this.options.element}set placeholder(e){this.options.placeholder=e}get placeholder(){return this.options.placeholder}set name(e){this.options.name=e}get name(){return this.options.name}set width(e){this.options.width=e}get width(){return this.options.width}set height(e){this.options.height=e}get height(){return this.options.height}set searchPlaceholder(e){this.options.searchPlaceholder=e}get searchPlaceholder(){return this.options.searchPlaceholder}set labelSelectAll(e){this.options.labelSelectAll=e}get labelSelectAll(){return this.options.labelSelectAll}set labelSelected(e){this.options.labelSelected=e}get labelSelected(){return this.options.labelSelected}}